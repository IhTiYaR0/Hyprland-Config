#!/usr/bin/env bash
set -euo pipefail
trap 'echo -e "\n${RED}‚ùå –û—à–∏–±–∫–∞ –Ω–∞ —Å—Ç—Ä–æ–∫–µ $LINENO. –£—Å—Ç–∞–Ω–æ–≤–∫–∞ –æ—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∞.${NC}" >&2; exit 1' ERR

# –¶–≤–µ—Ç–∞ –∏ —Å–∏–º–≤–æ–ª—ã
GREEN='\033[1;32m'
YELLOW='\033[1;33m'
BLUE='\033[1;34m'
RED='\033[1;31m'
BOLD='\033[1m'
NC='\033[0m'

CHECK="${GREEN}‚úî${NC}"
CROSS="${RED}‚úò${NC}"
ARROW="${BLUE}‚û§${NC}"

# –°—Ç–∏–ª—å–Ω—ã–π –∑–∞–≥–æ–ª–æ–≤–æ–∫
clear
echo -e "${BOLD}${BLUE}"
echo "‚ïî‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïó"
echo "‚ïë              üíéÔ∏è Hyprland-Config üíéÔ∏è             ‚ïë"
echo "‚ïö‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïù"
echo -e "${NC}"

# –ü–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏–µ
read -rp "$(echo -e "${YELLOW}‚ö†Ô∏è  –í—Å–µ –≤–∞—à–∏ –∫–æ–Ω—Ñ–∏–≥–∏ –≤ ~/.config –∏ ~/.Wallpapers –±—É–¥—É—Ç –ü–û–õ–ù–û–°–¢–¨–Æ –∑–∞–º–µ–Ω–µ–Ω—ã.
–¢–∞–∫–∂–µ shell –±—É–¥–µ—Ç –∏–∑–º–µ–Ω—ë–Ω –Ω–∞ fish, –∏ –ø—Ä–æ–∏–∑–æ–π–¥—ë—Ç –ø–µ—Ä–µ–∑–∞–≥—Ä—É–∑–∫–∞.
–ü—Ä–æ–¥–æ–ª–∂–∏—Ç—å —É—Å—Ç–∞–Ω–æ–≤–∫—É? [y/N]:${NC} ")" CONFIRM
CONFIRM=${CONFIRM,,}
if [[ "$CONFIRM" != "y" ]]; then
  echo -e "${CROSS} –£—Å—Ç–∞–Ω–æ–≤–∫–∞ –æ—Ç–º–µ–Ω–µ–Ω–∞ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–º."; exit 1
fi

# 1Ô∏è‚É£ –£—Å—Ç–∞–Ω–æ–≤–∫–∞ –ø–∞–∫–µ—Ç–æ–≤
echo -e "\n${ARROW} ${BOLD}–£—Å—Ç–∞–Ω–æ–≤–∫–∞ –ø–∞–∫–µ—Ç–æ–≤ —á–µ—Ä–µ–∑ installpkg.sh...${NC}"
if [[ -x "./installpkg.sh" ]]; then
  ./installpkg.sh && echo -e "${CHECK} –ü–∞–∫–µ—Ç—ã —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω—ã."
else
  echo -e "${CROSS} installpkg.sh –Ω–µ –Ω–∞–π–¥–µ–Ω –∏–ª–∏ –Ω–µ –∏—Å–ø–æ–ª–Ω—è–µ–º—ã–π."; exit 1
fi

# 2Ô∏è‚É£ –°–º–µ–Ω–∞ –æ–±–æ–ª–æ—á–∫–∏ –Ω–∞ fish
echo -e "\n${ARROW} ${BOLD}–£—Å—Ç–∞–Ω–æ–≤–∫–∞ Fish –∫–∞–∫ shell –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é...${NC}"
if command -v fish >/dev/null && grep -q "/usr/bin/fish" /etc/shells; then
  chsh -s /usr/bin/fish
  echo -e "${CHECK} Fish —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω –∫–∞–∫ –æ–±–æ–ª–æ—á–∫–∞ –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é."
else
  echo -e "${CROSS} –ù–µ —É–¥–∞–ª–æ—Å—å —É—Å—Ç–∞–Ω–æ–≤–∏—Ç—å fish. –£–±–µ–¥–∏—Ç–µ—Å—å, —á—Ç–æ –æ–Ω —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω –∏ –ø—Ä–æ–ø–∏—Å–∞–Ω –≤ /etc/shells."; exit 1
fi

# –§—É–Ω–∫—Ü–∏—è –∫–æ–ø–∏—Ä–æ–≤–∞–Ω–∏—è —Å –∑–∞–º–µ–Ω–æ–π
copy_replace() {
  local src="$1" dst="$2"
  if [[ -d "$dst" ]]; then
    echo -e "${YELLOW}  - –£–¥–∞–ª–µ–Ω–∏–µ —Å—Ç–∞—Ä–æ–π –ø–∞–ø–∫–∏: $dst${NC}"
    rm -rf "$dst"
  fi
  echo -e "${GREEN}  + –ö–æ–ø–∏—Ä–æ–≤–∞–Ω–∏–µ: $src ‚Üí $dst${NC}"
  cp -a "$src" "$dst"
}

# 3Ô∏è‚É£ –ö–æ–ø–∏—Ä–æ–≤–∞–Ω–∏–µ –∫–æ–Ω—Ñ–∏–≥–æ–≤
echo -e "\n${ARROW} ${BOLD}–£—Å—Ç–∞–Ω–æ–≤–∫–∞ –∫–æ–Ω—Ñ–∏–≥–æ–≤ (.config)...${NC}"
for dir in .config/*; do
  copy_replace "$dir" "$HOME/.config/$(basename "$dir")"
done
echo -e "${CHECK} –ö–æ–Ω—Ñ–∏–≥–∏ —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω—ã."

# 4Ô∏è‚É£ –ö–æ–ø–∏—Ä–æ–≤–∞–Ω–∏–µ –æ–±–æ–µ–≤
echo -e "\n${ARROW} ${BOLD}–£—Å—Ç–∞–Ω–æ–≤–∫–∞ –æ–±–æ–µ–≤ (.Wallpapers)...${NC}"
copy_replace ".Wallpapers" "$HOME/.Wallpapers"
echo -e "${CHECK} –û–±–æ–∏ —Å–∫–æ–ø–∏—Ä–æ–≤–∞–Ω—ã."

# ‚úÖ –ó–∞–≤–µ—Ä—à–µ–Ω–∏–µ
echo -e "\n${GREEN}üéâ –£—Å—Ç–∞–Ω–æ–≤–∫–∞ –∑–∞–≤–µ—Ä—à–µ–Ω–∞ —É—Å–ø–µ—à–Ω–æ!${NC}"
echo -e "${YELLOW}üîÅ –ü–µ—Ä–µ–∑–∞–≥—Ä—É–∑–∫–∞ —á–µ—Ä–µ–∑ 5 —Å–µ–∫—É–Ω–¥...${NC}"
sleep 5
exec sudo reboot

